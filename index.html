<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Overcalc</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
</head>
<body>
<div class="container">
    <div class="row justify-content-md-center">
        <div class="col-md-6">
            <h1>Overcalc</h1>
            <form>
                <label>–¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å</label>
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <button id="decrementCurrentLevel" class="btn btn-outline-primary" type="button">-1</button>
                    </div>
                    <input class="form-control" id="currentLevel" type="number" placeholder="–¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å" value="0">
                    <div class="input-group-append">
                        <button id="incrementCurrentLevel" class="btn btn-outline-primary" type="button">+1</button>
                    </div>
                </div>

                
                <label>–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–π —É—Ä–æ–≤–µ–Ω—å</label>
                <input class="form-control  mb-3" id="targetLevel" type="number" placeholder="–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–π —É—Ä–æ–≤–µ–Ω—å" value="200"
                       disabled>
                <label>–î–Ω–µ–π –æ—Å—Ç–∞–ª–æ—Å—å –¥–æ –∫–æ–Ω—Ü–∞ –ë–ü</label>
                <input class="form-control  mb-3" id="daysRemaining" type="number" placeholder="–î–Ω–µ–π –æ—Å—Ç–∞–ª–æ—Å—å –¥–æ –∫–æ–Ω—Ü–∞ –ë–ü"
                       value="62" disabled>
            </form>
            <div class="pt-3">
                <h2>–î–Ω–∏ —Ñ–∞—Ä–º–∞</h2>
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th scope="col">–î–µ–Ω—å</th>
                        <th scope="col">–î–∞—Ç–∞</th>
                        <th scope="col">–£—Ä–æ–≤–µ–Ω—å</th>
                    </tr>
                    </thead>
                    <tbody id="daysList">
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.1.min.js"
        integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>

<script>
    class Event {
        constructor(name, dateStart, dateEnd, emoji) {
            this.name = name;
            this.dateStart = new Date(dateStart);
            this.dateEnd = new Date(dateEnd);
            this.emoji = emoji;
        }
    }

    const startLevel = 1;
    const endLevel = 200;
    const currentDay = Date.now();
    const startDay = new Date('12/06/2022');
    const endDay = new Date('02/07/2023');
    const diffTime = Math.abs(endDay - startDay);
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    const diffTimeFromNow = Math.abs(currentDay - startDay);
    const diffDaysFromNow = Math.ceil(diffTimeFromNow / (1000 * 60 * 60 * 24));
    const daysRemains = Math.abs(endDay - currentDay);
    const daysRemainsDiff = Math.ceil(daysRemains / (1000 * 60 * 60 * 24));
    $('#daysRemaining').val(daysRemainsDiff);
    const winterWonderland = new Event("–ó–∏–º–Ω—è—è –°–∫–∞–∑–∫–∞", "12/13/2022", "01/04/2023", "‚ùÑ");
    const BattleForOlympus = new Event("–ë–∏—Ç–≤–∞ –∑–∞ –û–ª–∏–º–ø", "01/05/2023", "01/19/2023", "üèÜ");
    const LunarNewYear = new Event("–õ—É–Ω–Ω—ã–π –ù–æ–≤—ã–π –ì–æ–¥", "01/17/2023", "02/06/2023", "üê∞");
    const events = [winterWonderland, BattleForOlympus, LunarNewYear];

    function calculateDays() {
        let date = new Date(startDay);
        $('#daysList').empty();
        let currentLevel = parseInt($('#currentLevel').val());
        localStorage.setItem('currentLevel', currentLevel);

        let levelsForDay = (endLevel - startLevel) / diffDays;
        for (let index = 1; index <= diffDays; index++) {
            expectedLevel = startLevel + Math.ceil(levelsForDay * index);
            if (index === diffDaysFromNow) {
                levelDiff = currentLevel - expectedLevel;
                if (levelDiff >= 0) {
                    levelDiff = '<span style="color:green;">+' + levelDiff + ' –û–ø–µ—Ä–µ–∂–∞–µ—Ç</span>';
                } else {
                    levelDiff = '<span style="color:red;">' + levelDiff + ' –û–ø–∞–∑–¥—ã–≤–∞–µ—Ç</span>';
                }
                expectedLevel = expectedLevel + ' <b>' + levelDiff + '</b>';
            }
            let eventString = ' ';
            events.forEach(function (event){
                if (date >= event.dateStart && date <= event.dateEnd) {
                    eventString = eventString + ' <span title="'+event.name+'">' + event.emoji + '</>';
                }
            })
            let row = '<tr><th scope="row">' + index + '</th><td>' + date.toLocaleDateString() + eventString + '</td><td>' + expectedLevel + '</td></tr>'
            date.setDate(date.getDate() + 1)
            if (index >= diffDaysFromNow) {
                $('#daysList').append(row);
            }
        }
    }

    savedCurrentLevel = localStorage.getItem('currentLevel');
    if (savedCurrentLevel > 0) {
        $('#currentLevel').val(savedCurrentLevel);
    }

    calculateDays();
    $('#currentLevel').on('change', function () {
        calculateDays();
    })

    $('#decrementCurrentLevel').on('click', function () {
        let currentLevel = parseInt($('#currentLevel').val());
        currentLevel--;
        $('#currentLevel').val(currentLevel);
        calculateDays();
    })
    $('#incrementCurrentLevel').on('click', function () {
        let currentLevel = parseInt($('#currentLevel').val());
        currentLevel++;
        $('#currentLevel').val(currentLevel);
        calculateDays();
    })
</script>
</body>
</html>